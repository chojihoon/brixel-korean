/**
 * OLED Korean Extension with Complete 8x4x4 Hangul Font
 * 8벌식 조합형 한글 폰트 (초성 8벌, 중성 4벌, 종성 4벌)
 * Font: hmgothic (휴먼고딕체)
 */
//% weight=100 color=#2c3e50 icon="\uf108" block="OLED Korean"
//% groups=["OLED 0.96 SSD1306", "OLED 1.3 SH1106"]
namespace OLEDKorean {

    // ============================================================
    // 8벌식 조합형 한글 벌수 테이블
    // ============================================================
    
    // 초성 벌수 테이블 (받침 없을 때) - 인덱스: 중성(1-21)
    const cho1: number[] = [0, 0,0,0,0,0,0,0,0,1,3,3,3,1,2,4,4,4,2,1,3,0];
    
    // 초성 벌수 테이블 (받침 있을 때)
    const cho2: number[] = [0, 5,5,5,5,5,5,5,5,6,7,7,7,6,6,7,7,7,6,6,7,5];
    
    // 종성 벌수 테이블
    const jong: number[] = [0, 0,2,0,2,1,2,1,2,3,0,2,1,3,3,1,2,1,3,3,1,1];

    // ============================================================
    // 한글 폰트 데이터 (16x16, 360글리프 x 32바이트 = 11,520바이트)
    // 구조: 초성 8벌(160) + 중성 4벌(88) + 종성 4벌(112) = 360글리프
    // ============================================================
    export const K_FONT = hex`
000000000000000000000000000000000000000000000000000000000000000000000082C262321E0E000000000000000000000000000000000000000000000000004262325E6E321E0E00000000000000000000000000000000000000000000000000FEFE808080800000000000000000000000000000000000000000000000000000FEFE8282828200000000000000000000000000000000000000000000000000FEFE82FEFE8282000000000000000000000000000000000000000000000000007A7A4A4A4A4E4E000000000000000000000000000000000000000000000000007E7E4242427E7E000000000000000000000000000000000000000000000000007E7E4848487E7E000000000000000000000000000000000000000000000000007E5E487E5E487E7E0000000000000000000000000000000000000000000000004060301E1E306040000000000000000000000000000000000000000000000040603E5E603E1E6040000000000000000000000000000000000000000000000000003C7E42427E3C000000000000000000000000000000000000000000000000004262321E1E326242000000000000000000000000000000000000000000000042623E5E623E1E62420000000000000000000000000000000000000000000000004464341E1E346444000000000000000000000000000000000000000000000000008ACA6A3A1E0E000000000000000000000000000000000000000000000000007E7E4A4A4A4A4000000000000000000000000000000000000000000000000000427E7E42427E7E42000000000000000000000000000000000000000000000000023A7E47477E3A0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002020202020202023E3E000000000000000000000000000000000000000000000202023E3E0202023E3E000000000000000000000000000000000000000000003E3E2020202020202020000000000000000000000000000000000000000000003E3E2222222222222222000000000000000000000000000000000000000000003E3E2222003E3E222222000000000000000000000000000000000000000000003A3A2A2A2A2A2A2A2E2E00000000000000000000000000000000000000000000003E3E222222223E3E00000000000000000000000000000000000000000000003E3E2828282828283E3E000000000000000000000000000000000000000000003E3E28283E3E28283E3E000000000000000000000000000000000000000000002030180C06060C1830200000000000000000000000000000000000000000000020301E1E30301E1E302000000000000000000000000000000000000000000000001C3E222222223E1C000000000000000000000000000000000000000000000022321A0E06060E1A32220000000000000000000000000000000000000000000022321A2E361A0E0E32220000000000000000000000000000000000000000000024341C0C06060C1C3424000000000000000000000000000000000000000000000A0A0A0A0A0A0A0A3E3E000000000000000000000000000000000000000000003E3E2A2A2A2A2A2A2A2A0000000000000000000000000000000000000000000022223E3E22223E3E222200000000000000000000000000000000000000000000021A3E262727263E1A0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002020202020202023E3E000000000000000000000000000000000000000000000202023E3E0202023E3E000000000000000000000000000000000000000000003E3E2020202020202020000000000000000000000000000000000000000000003E3E2222222222222222000000000000000000000000000000000000000000003E3E2222003E3E222222000000000000000000000000000000000000000000003A3A2A2A2A2A2A2A2E2E00000000000000000000000000000000000000000000003E3E222222223E3E00000000000000000000000000000000000000000000003E3E2828282828283E3E000000000000000000000000000000000000000000003E3E28283E3E28283E3E000000000000000000000000000000000000000000002030180C06060C1830200000000000000000000000000000000000000000000020301E1E30301E1E302000000000000000000000000000000000000000000000001C3E222222223E1C000000000000000000000000000000000000000000000022321A0E06060E1A32220000000000000000000000000000000000000000000022321A2E361A0E0E32220000000000000000000000000000000000000000000024341C0C06060C1C3424000000000000000000000000000000000000000000000A0A0A0A0A0A0A0A3E3E000000000000000000000000000000000000000000003E3E2A2A2A2A2A2A2A2A0000000000000000000000000000000000000000000022223E3E22223E3E222200000000000000000000000000000000000000000000021A3E262727263E1A02000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002020202023E3E00000000000000000000000000000000000000000000000002023E3E02023E3E000000000000000000000000000000000000000000000000003E3E2020202020200000000000000000000000000000000000000000000000003E3E2222222222220000000000000000000000000000000000000000000000003E3E22223E3E22220000000000000000000000000000000000000000000000003A3A2A2A2A2E2E000000000000000000000000000000000000000000000000003E3E2222223E3E000000000000000000000000000000000000000000000000003E3E2828283E3E000000000000000000000000000000000000000000000000003E2E283E2E283E3E0000000000000000000000000000000000000000000000002030180E0E18302000000000000000000000000000000000000000000000000020301E2E301E0E30200000000000000000000000000000000000000000000000001C3E22223E1C0000000000000000000000000000000000000000000000000022321A0E0E1A3222000000000000000000000000000000000000000000000022321E2E321E0E322200000000000000000000000000000000000000000000000024341C0E0E1C34240000000000000000000000000000000000000000000000000A0A0A0A0A0A3E3E0000000000000000000000000000000000000000000000003E3E2A2A2A2A2A00000000000000000000000000000000000000000000000000223E3E22223E3E22000000000000000000000000000000000000000000000000021A3E27273E1A02000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002020202023E3E00000000000000000000000000000000000000000000000002023E3E02023E3E000000000000000000000000000000000000000000000000003E3E2020202020200000000000000000000000000000000000000000000000003E3E2222222222220000000000000000000000000000000000000000000000003E3E22223E3E22220000000000000000000000000000000000000000000000003A3A2A2A2A2E2E000000000000000000000000000000000000000000000000003E3E2222223E3E000000000000000000000000000000000000000000000000003E3E2828283E3E000000000000000000000000000000000000000000000000003E2E283E2E283E3E0000000000000000000000000000000000000000000000002030180E0E18302000000000000000000000000000000000000000000000000020301E2E301E0E30200000000000000000000000000000000000000000000000001C3E22223E1C0000000000000000000000000000000000000000000000000022321A0E0E1A3222000000000000000000000000000000000000000000000022321E2E321E0E322200000000000000000000000000000000000000000000000024341C0E0E1C34240000000000000000000000000000000000000000000000000A0A0A0A0A0A3E3E0000000000000000000000000000000000000000000000003E3E2A2A2A2A2A00000000000000000000000000000000000000000000000000223E3E22223E3E22000000000000000000000000000000000000000000000000021A3E27273E1A02000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000082C262321E0E000000000000000000000000000000000000000000000000004262325E6E321E0E00000000000000000000000000000000000000000000000000FEFE808080808000000000000000000000000000000000000000000000000000FEFE828282820000000000000000000000000000000000000000000000000000FEFE82FEFE8282000000000000000000000000000000000000000000000000007A7A4A4A4E4E00000000000000000000000000000000000000000000000000007E7E42427E7E00000000000000000000000000000000000000000000000000007E7E48487E7E000000000000000000000000000000000000000000000000007E5E487E5E487E000000000000000000000000000000000000000000000000004060301E1E306040000000000000000000000000000000000000000000000040603E5E603E1E6040000000000000000000000000000000000000000000000000003C7E42427E3C000000000000000000000000000000000000000000000000004262321E1E326242000000000000000000000000000000000000000000000042623E5E623E1E62400000000000000000000000000000000000000000000000004464341E1E346444000000000000000000000000000000000000000000000000008ACA6A3A1E0E00000000000000000000000000000000000000000000000000007E7E4A4A4A4A00000000000000000000000000000000000000000000000000427E7E427E7E4200000000000000000000000000000000000000000000000000023A7E47477E3A020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002020202020202023E3E000000000000000000000000000000000000000000000202023E3E0202023E3E000000000000000000000000000000000000000000003E3E2020202020202020000000000000000000000000000000000000000000003E3E2222222222222222000000000000000000000000000000000000000000003E3E2222003E3E222222000000000000000000000000000000000000000000003A3A2A2A2A2A2A2A2E2E00000000000000000000000000000000000000000000003E3E222222223E3E00000000000000000000000000000000000000000000003E3E2828282828283E3E000000000000000000000000000000000000000000003E3E28283E3E28283E3E000000000000000000000000000000000000000000002030180C06060C1830200000000000000000000000000000000000000000000020301E1E30301E1E302000000000000000000000000000000000000000000000001C3E222222223E1C000000000000000000000000000000000000000000000022321A0E06060E1A32220000000000000000000000000000000000000000000022321A2E361A0E0E32220000000000000000000000000000000000000000000024341C0C06060C1C3424000000000000000000000000000000000000000000000A0A0A0A0A0A0A0A3E3E000000000000000000000000000000000000000000003E3E2A2A2A2A2A2A2A2A0000000000000000000000000000000000000000000022223E3E22223E3E222200000000000000000000000000000000000000000000021A3E262727263E1A020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020202023E3E0000000000000000000000000000000000000000000000000002023E3E02023E3E000000000000000000000000000000000000000000000000003E3E2020202020000000000000000000000000000000000000000000000000003E3E2222222200000000000000000000000000000000000000000000000000003E3E223E3E22220000000000000000000000000000000000000000000000003A3A2A2A2A2E2E000000000000000000000000000000000000000000000000003E3E2222223E3E000000000000000000000000000000000000000000000000003E3E2828283E3E000000000000000000000000000000000000000000000000003E2E283E2E283E000000000000000000000000000000000000000000000000002030180E0E18302000000000000000000000000000000000000000000000000020301E2E301E0E30200000000000000000000000000000000000000000000000001C3E22223E1C0000000000000000000000000000000000000000000000000022321A0E0E1A3222000000000000000000000000000000000000000000000022321E2E321E0E322200000000000000000000000000000000000000000000000024341C0E0E1C34240000000000000000000000000000000000000000000000000A0A0A0A0A3E3E00000000000000000000000000000000000000000000000000003E3E2A2A2A2A00000000000000000000000000000000000000000000000000223E3E223E3E2200000000000000000000000000000000000000000000000000021A3E27273E1A0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FEFE10100000000000000000000000001F1F000000000000000000000000FEFE20FEFE00000000000000000000000F0F001F1F00000000000000000000000000FEFE48480000000000000000000000001F1F000000000000000000000000FEFE90FEFE00000000000000000000000F0F001F1F00000000000000000000101010FEFE00000000000000000000000000001F1F000000000000000000101010FEFE00FEFE00000000000000000000000F0F001F1F00000000000000000000282828FEFE00000000000000000000000000001F1F000000000000000000282828FEFE00FEFE00000000000000000000000F0F001F1F0000000000000000808000000000000000000004040404040707040404040400000000000000808000000000FEFE80800000000202020303020202001F1F00000000000000808000000000FEFE20FEFE00000202020303020202020F0F001F1F00000000000080800000000000FEFE00000000020202030302020202021F1F0000000000000080800000808000000000000000040404070704040707040404000000000000000000000000000000000000000001010101013F3F01010101010000000080808080808080808000FEFE000000000000001F1F00000404043F3F000000808080808080808000FEFE00FEFE00000000000F0F000404041F1F003F3F00000080808080808080808000FEFE000000000000001F1F00000000003F3F00000000000000000000000000000000000000000101013F3F01013F3F01010100000000000000000000000000000000000000000404040404040404040404040400000000000000000000000000FEFE00000000010101010101010101001F1F0000000000000000000000000000FEFE00000000000000000000000000001F1F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FEFE10100000000000000000000000001F1F000000000000000000000000FEFE20FEFE00000000000000000000000F0F001F1F00000000000000000000000000FEFE48480000000000000000000000001F1F000000000000000000000000FEFE90FEFE00000000000000000000000F0F001F1F00000000000000000000101010FEFE00000000000000000000000000001F1F000000000000000000101010FEFE00FEFE00000000000000000000000F0F001F1F00000000000000000000282828FEFE00000000000000000000000000001F1F000000000000000000282828FEFE00FEFE00000000000000000000000F0F001F1F0000000000000000808000000000000000000004040404040707040404040400000000000000808000000000FEFE80800000000202020303020202001F1F00000000000000808000000000FEFE20FEFE00000202020303020202020F0F001F1F00000000000080800000000000FEFE00000000020202030302020202021F1F0000000000000080800000808000000000000000040404070704040707040404000000000000000000000000000000000000000001010101013F3F01010101010000000080808080808080808000FEFE000000000000001F1F00000404043F3F000000808080808080808000FEFE00FEFE00000000000F0F000404041F1F003F3F00000080808080808080808000FEFE000000000000001F1F00000000003F3F00000000000000000000000000000000000000000101013F3F01013F3F01010100000000000000000000000000000000000000000404040404040404040404040400000000000000000000000000FEFE00000000010101010101010101001F1F0000000000000000000000000000FEFE00000000000000000000000000001F1F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FEFE10100000000000000000000000000101000000000000000000000000FEFE10FEFE0000000000000000000000010100010100000000000000000000000000FEFE28280000000000000000000000000101000000000000000000000000FEFE50FEFE0000000000000000000000010100010100000000000000000000101010FEFE00000000000000000000000000000101000000000000000000101010FEFE00FEFE0000000000000000000000010100010100000000000000000000282828FEFE00000000000000000000000000000101000000000000000000002828FEFE00FEFE000000000000000000000001010001010000000000000000E0E000000000000000000001010101010101010101010100000000000000C0C00000000000FEFE10100000010101010101010101000101000000000000C0C000000000FEFE10FEFE00000101010101010101000101000101000000000000C0C00000000000FEFE0000000001010101010101010100010100000000000000C0C00000C0C00000000000000001010101010101010101010100000000808080808080808080808080000000000000000000030300000000000000000080808080808080001010FEFE00000000000203010000000000000101000000808080808080809010FEFE00FEFE0000000002030100000000010100010100000080808080808080808000FEFE00000000000203010000000000000101000000008080808080808080808080800000000000000003030000030300000000000000000000000000000000000000000000000101010101010101010101010000000000000000000000000000FEFE000000000101010101010101010001010000000000000000000000000000FEFE0000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FEFE10100000000000000000000000000101000000000000000000000000FEFE10FEFE0000000000000000000000010100010100000000000000000000000000FEFE28280000000000000000000000000101000000000000000000000000FEFE50FEFE0000000000000000000000010100010100000000000000000000101010FEFE00000000000000000000000000000101000000000000000000101010FEFE00FEFE0000000000000000000000010100010100000000000000000000282828FEFE00000000000000000000000000000101000000000000000000002828FEFE00FEFE000000000000000000000001010001010000000000000000E0E000000000000000000001010101010101010101010100000000000000C0C00000000000FEFE10100000010101010101010101000101000000000000C0C000000000FEFE10FEFE00000101010101010101000101000101000000000000C0C00000000000FEFE0000000001010101010101010100010100000000000000C0C00000C0C00000000000000001010101010101010101010100000000808080808080808080808080000000000000000000030300000000000000000080808080808080001010FEFE00000000000203010000000000000101000000808080808080809010FEFE00FEFE0000000002030100000000010100010100000080808080808080808000FEFE00000000000203010000000000000101000000008080808080808080808080800000000000000003030000030300000000000000000000000000000000000000000000000101010101010101010101010000000000000000000000000000FEFE000000000101010101010101010001010000000000000000000000000000FEFE0000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040404040404047C7C000000000000000000000000000000000000000000000404047C7C0404047C7C000000000000000000000000000000000000000000000404047C7C40603C3C604000000000000000000000000000000000000000000000007C7C40404040404000000000000000000000000000000000000000000000007C7C404044643C3C6444000000000000000000000000000000000000000000007C7C404028785C5C782800000000000000000000000000000000000000000000007C7C4444444444440000000000000000000000000000000000000000000000007474545454545C5C00000000000000000000000000000000000000000000007474545C5C04047C7C000000000000000000000000000000000000000000007474545C5C007C7C447C7C0000000000000000000000000000000000000000007474545C5C007C7C507C7C000000000000000000000000000000000000000000007474545C5C40603C3C604000000000000000000000000000000000000000007474545C5C007C7C5454540000000000000000000000000000000000000000007474545C5C00447C447C440000000000000000000000000000000000000000007474545C5C28785C5C782800000000000000000000000000000000000000000000007C7C444444447C7C0000000000000000000000000000000000000000000000007C7C505050507C7C00000000000000000000000000000000000000000000007C7C507C7C40603C3C6040000000000000000000000000000000000000000000406030180C0C18306040000000000000000000000000000000000000000000004060305C7C301C1C3060400000000000000000000000000000000000000000000000387C4444447C3800000000000000000000000000000000000000000000004848283818183828484800000000000000000000000000000000000000000000484828381C1C3828484800000000000000000000000000000000000000000000141414141414147C7C000000000000000000000000000000000000000000000000007C7C5454545454000000000000000000000000000000000000000000000000447C7C44447C7C440000000000000000000000000000000000000000000000000828785C5C5C782808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040404040404047C7C000000000000000000000000000000000000000000000404047C7C0404047C7C000000000000000000000000000000000000000000000404047C7C40603C3C604000000000000000000000000000000000000000000000007C7C40404040404000000000000000000000000000000000000000000000007C7C404044643C3C6444000000000000000000000000000000000000000000007C7C404028785C5C782800000000000000000000000000000000000000000000007C7C4444444444440000000000000000000000000000000000000000000000007474545454545C5C00000000000000000000000000000000000000000000007474545C5C04047C7C000000000000000000000000000000000000000000007474545C5C007C7C447C7C0000000000000000000000000000000000000000007474545C5C007C7C507C7C000000000000000000000000000000000000000000007474545C5C40603C3C604000000000000000000000000000000000000000007474545C5C007C7C5454540000000000000000000000000000000000000000007474545C5C00447C447C440000000000000000000000000000000000000000007474545C5C28785C5C782800000000000000000000000000000000000000000000007C7C444444447C7C0000000000000000000000000000000000000000000000007C7C505050507C7C00000000000000000000000000000000000000000000007C7C507C7C40603C3C6040000000000000000000000000000000000000000000406030180C0C18306040000000000000000000000000000000000000000000004060305C7C301C1C3060400000000000000000000000000000000000000000000000387C4444447C3800000000000000000000000000000000000000000000004848283818183828484800000000000000000000000000000000000000000000484828381C1C3828484800000000000000000000000000000000000000000000141414141414147C7C000000000000000000000000000000000000000000000000007C7C5454545454000000000000000000000000000000000000000000000000447C7C44447C7C440000000000000000000000000000000000000000000000000828785C5C5C78280800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004040404040404047C7C000000000000000000000000000000000000000000040404047C7C0404047C7C000000000000000000000000000000000000000000040404047C7C40603C3C6040000000000000000000000000000000000000000000007C7C40404040404040000000000000000000000000000000000000000000007C7C404044643C3C64440000000000000000000000000000000000000000007C7C40404028785C5C782800000000000000000000000000000000000000000000007C7C444444444444440000000000000000000000000000000000000000000000747454545454545C5C000000000000000000000000000000000000000000007474545C5C0404047C7C0000000000000000000000000000000000000000007474545C5C007C7C447C7C0000000000000000000000000000000000000000007474545C5C007C7C507C7C000000000000000000000000000000000000000000007474545C5C40603C3C604000000000000000000000000000000000000000007474545C5C007C7C5454540000000000000000000000000000000000000000007474545C5C00447C447C440000000000000000000000000000000000000000007474545C5C0028785C5C7828000000000000000000000000000000000000000000007C7C44444444447C7C00000000000000000000000000000000000000000000007C7C50505050507C7C000000000000000000000000000000000000000000007C7C507C7C40603C3C6040000000000000000000000000000000000000000000406030180C0C18306040000000000000000000000000000000000000000000004060305C7C301C1C306040000000000000000000000000000000000000000000000000387C4444447C38000000000000000000000000000000000000000000004848283818183828484800000000000000000000000000000000000000000000484828381C1C382848480000000000000000000000000000000000000000000000141414141414147C7C0000000000000000000000000000000000000000000000007C7C5454545454540000000000000000000000000000000000000000000044447C7C44447C7C444400000000000000000000000000000000000000000000000828785C5C5C5C78280800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004040404040404047C7C000000000000000000000000000000000000000000000404047C7C0404047C7C000000000000000000000000000000000000000000000404047C7C40603C3C60400000000000000000000000000000000000000000007C7C4040404040404040000000000000000000000000000000000000000000007C7C40404044643C3C64440000000000000000000000000000000000000000007C7C40404028785C5C78280000000000000000000000000000000000000000007C7C44444444444444440000000000000000000000000000000000000000000074745454545454545C5C000000000000000000000000000000000000000000007474545C5C0004047C7C000000000000000000000000000000000000000000007474545C5C007C7C447C7C0000000000000000000000000000000000000000007474545C5C007C7C507C7C0000000000000000000000000000000000000000007474545C5C40603C3C60400000000000000000000000000000000000000000007474545C5C007C7C5454540000000000000000000000000000000000000000007474545C5C00447C447C440000000000000000000000000000000000000000007474545C5C28785C5C78280000000000000000000000000000000000000000007C7C4444444444447C7C000000000000000000000000000000000000000000007C7C5050505050507C7C000000000000000000000000000000000000000000007C7C507C7C40603C3C6040000000000000000000000000000000000000000000406030180C0C18306040000000000000000000000000000000000000000000004060305C7C301C1C30604000000000000000000000000000000000000000000000387C444444447C3800000000000000000000000000000000000000000000004868381808081838684800000000000000000000000000000000000000000000486838180C0C183868480000000000000000000000000000000000000000000014141414141414147C7C000000000000000000000000000000000000000000007C7C54545454545454540000000000000000000000000000000000000000000044447C7C44447C7C4444000000000000000000000000000000000000000000000828785C5C5C5C782808000000`;

    // ============================================================
    // ASCII 폰트 (8x16, 128글리프 x 16바이트 = 2,048바이트)
    // ============================================================
    export const E_FONT = hex`
0000000000000000000000000000000000F8041404041404F80708090B0B09080701F8FC6C7C7C6CFCF8070F0F0C0C0F0F070200F0F8F8F0F8F8F00000010307030100030040E0F0F8F0E040000000010301000004E0E0F81C1CF8E0E000000407070400000560F0F8FCFCF8F060000004070704000006000060F0F060000000000000000000000700FF1F0F0F0F1FFF00FFFFFEFEFEFFFF080000E0101010E00000000001010100000900FF1FEFEFEF1FFF00FFFFFEFEFEFFFF0A000090487C48900000030408080804030B0030488484844830000202020F0202020C000000FC0408700000060F07000000000D000000FC141414FC000C1E0F00060F070E5050E0BCBCE0505001010007070001010F0000FCF8F0E04000000007030100000010000040E0F0F8FC00000000000103070011001018FCFC1810000001030707030100120000FCFC0000FCFC000004040000040413387C44FCFC04FCFC00000007070007071400C4EE3A1232E6C40008191312171D08150000000000000000000E0E0E0E0E0E0016001018FCFC18100008090B0F0F0B090817001018FCFC181000000000070700000018000000FCFC0000000001030707030100190040404050F0E04000000000010100001A0040E0F05040404000000001010000001BF80000000000000003020202020202021C40E050404050E04000000100000100001D000000C0F0C0000000040707070707041E001070F0F0F0701000000001070100001F00000000000000000000000000000000000038FCFC3800000000000D0D000000000E1E00001E0E00000000000000000020F8F820F8F82000020F0F020F0F0200387C444747CC9800060C0838380F070030300080C06030000C060301000C0C0080D87CE4BCD84000070F0808070F080000101E0E0000000000000000000000000000F0F80C040000000003070C0800000000040CF8F000000000080C0703000080A0E0C0C0E0A0800002030101030200008080E0E0808000000000030300000000000000000000000000101E0E0000008080808080808000000000000000000000000000000000000000000C0C00000000000080C06030000C06030100000000F0F80CC40CF8F00003070C080C070300001018FCFC0000000008080F0F080800080C84C4643C18000E0F0908080C0C00080C444444FCB800040C0808080F0700C0E0B098FCFC8000000000080F0F08007C7C444444C48400040C0808080F0700F0F84C4444C08000070F0808080F07000C0C0484C47C3C0000000F0F00000000B8FC444444FCB800070F0808080F0700387C444444FCF800000808080C0703000000003030000000000000060600000000000030300000000000080E060000000080C0603018080000000103060C0800002020202020200000010101010101000008183060C0800000080C0603010000181C04C4E43C18000000000D0D000000F0F808C8C8F8F000070F080B0B0B0100E0F0988C98F0E0000F0F0000000F0F0004FCFC4444FCB800080F0F08080F0700F0F80C04040C180003070C08080C060004FCFC040CF8F000080F0F080C07030004FCFC44E40C1C00080F0F08080C0E0004FCFC44E40C1C00080F0F0800000000F0F80C84848C980003070C0808070F00FCFC404040FCFC000F0F0000000F0F00000004FCFC0400000000080F0F08000000000004FCFC0400070F08080F07000004FCFCC0E03C1C00080F0F00010F0E0004FCFC0400000000080F0F08080C0E00FCFC387038FCFC000F0F0000000F0F00FCFC3870E0FCFC000F0F0000000F0F00F8FC040404FCF800070F0808080F070004FCFC44447C3800080F0F0800000000F8FC040404FCF800070F080E3C3F270004FCFC44C4FC3800080F0F00000F0F00183C6444C49C1800060E0808080F0700001C0CFCFC0C1C000000080F0F080000FCFC000000FCFC00070F0808080F0700FCFC000000FCFC000103060C06030100FCFC00C000FCFC00070F0E030E0F07000C3CF0E0F03C0C000C0F0301030F0C00003C7CC0C07C3C000000080F0F0800001C0C84C4643C1C000E0F0908080C0E000000FCFC0404000000000F0F080800003870E0C0800000000000000103070E0000000404FCFC0000000008080F0F0000080C0603060C08000000000000000000000000000000000020202020202020200000030704000000000000000000000000A0A0A0E0C00000070F0808070F080004FCFC2060C08000000F0F08080F0700C0E0202020604000070F0808080C040080C06024FCFC0000070F0808070F0800C0E0A0A0A0E0C000070F0808080C040040F8FC440C180000080F0F0800000000C0E02020C0E02000276F48487F3F000004FCFC4020E0C000080F0F00000F0F00000020ECEC0000000000080F0F0800000000000020ECEC0000307040407F3F0004FCFC80C0602000080F0F01030E0C00000004FCFC0000000000080F0F080000E0E060C060E0C0000F0F0007000F0F0020E0C02020E0C000000F0F00000F0F00C0E0202020E0C000070F0808080F070020E0C02020E0C000407F7F48080F0700C0E02020C0E02000070F08487F7F400020E0C06020E0C000080F0F080000000040E0A02020604000040C09090B0E04002020F8FC202000000000070F080C0400E0E00000E0E00000070F0808070F080000E0E00000E0E0000003070C0C070300E0E0008000E0E000070F0C070C0F07002060C080C0602000080C0703070C0800E0E0000000E0E000474F4848683F1F00606020A0E06020000C0E0B09080C0C00004040F8BC040400000000070F080800000000BCBC0000000000000F0F000000000404BCF84040000008080F07000000`;

    // ============================================================
    // OLED 제어 변수
    // ============================================================
    let OLED_ADDR = 0x3C;
    let oled_buffer: Buffer = null;
    let initialized = false;
    let isOLED_SH1106 = false;

    function ensureBuffer() {
        if (oled_buffer == null) {
            oled_buffer = pins.createBuffer(1025);
            oled_buffer[0] = 0x40;
            for (let i = 1; i < 1025; i++) {
                oled_buffer[i] = 0;
            }
        }
    }

    function cmd(c: number) {
        let buf = pins.createBuffer(2);
        buf[0] = 0x00;
        buf[1] = c;
        pins.i2cWriteBuffer(OLED_ADDR, buf);
    }

    function initOLED_SSD1306() {
        cmd(0xAE); // Display Off
        cmd(0xD5); cmd(0x80); // Clock
        cmd(0xA8); cmd(0x3F); // Multiplex 64
        cmd(0xD3); cmd(0x00); // Offset
        cmd(0x40); // Start line
        cmd(0x8D); cmd(0x14); // Charge pump
        cmd(0x20); cmd(0x00); // Memory mode horizontal
        cmd(0xA1); // Segment remap
        cmd(0xC8); // COM scan
        cmd(0xDA); cmd(0x12); // COM pins
        cmd(0x81); cmd(0xCF); // Contrast
        cmd(0xD9); cmd(0xF1); // Precharge
        cmd(0xDB); cmd(0x40); // VCOM
        cmd(0xA4); // Resume
        cmd(0xA6); // Normal
        cmd(0xAF); // Display On
        initialized = true;
        isOLED_SH1106 = false;
    }

    function initOLED_SH1106() {
        cmd(0xAE); // Display Off
        cmd(0xD5); cmd(0x80); // Clock
        cmd(0xA8); cmd(0x3F); // Multiplex
        cmd(0xD3); cmd(0x00); // Offset
        cmd(0x40); // Start line
        cmd(0xAD); cmd(0x8B); // DC-DC
        cmd(0x32); // Pump voltage
        cmd(0xA1); // Segment remap
        cmd(0xC8); // COM scan
        cmd(0xDA); cmd(0x12); // COM pins
        cmd(0x81); cmd(0x80); // Contrast
        cmd(0xD9); cmd(0x1F); // Precharge
        cmd(0xDB); cmd(0x40); // VCOM
        cmd(0xA6); // Normal
        cmd(0xAF); // Display On
        initialized = true;
        isOLED_SH1106 = true;
    }

    // ============================================================
    // 공개 API
    // ============================================================

    //% blockId=oled_init_ssd1306
    //% block="OLED 0.96 SSD1306 초기화"
    //% group="OLED 0.96 SSD1306"
    //% weight=100
    export function initSSD1306(): void {
        ensureBuffer();
        initOLED_SSD1306();
        clearBuffer();
        refresh();
    }

    //% blockId=oled_init_sh1106
    //% block="OLED 1.3 SH1106 초기화"
    //% group="OLED 1.3 SH1106"
    //% weight=100
    export function initSH1106(): void {
        ensureBuffer();
        initOLED_SH1106();
        clearBuffer();
        refresh();
    }

    //% blockId=oled_clear
    //% block="OLED 화면 지우기"
    //% group="OLED 0.96 SSD1306"
    //% weight=90
    export function clearBuffer(): void {
        ensureBuffer();
        for (let i = 1; i < 1025; i++) {
            oled_buffer[i] = 0;
        }
    }

    //% blockId=oled_refresh
    //% block="OLED 화면 갱신"
    //% group="OLED 0.96 SSD1306"
    //% weight=85
    export function refresh(): void {
        ensureBuffer();
        if (!initialized) return;
        
        let colOffset = isOLED_SH1106 ? 2 : 0;
        
        for (let page = 0; page < 8; page++) {
            cmd(0xB0 + page);
            cmd(0x00 + (colOffset & 0x0F));
            cmd(0x10 + ((colOffset >> 4) & 0x0F));
            
            let pageBuf = pins.createBuffer(129);
            pageBuf[0] = 0x40;
            for (let col = 0; col < 128; col++) {
                pageBuf[1 + col] = oled_buffer[1 + (page * 128) + col];
            }
            pins.i2cWriteBuffer(OLED_ADDR, pageBuf);
        }
    }

    //% blockId=oled_show_korean_text
    //% block="OLED 한글출력 $hexCodes x: $x y: $y"
    //% hexCodes.defl="BC24 C591 AC31"
    //% x.min=0 x.max=127 x.defl=0
    //% y.min=0 y.max=6 y.defl=0
    //% group="OLED 0.96 SSD1306"
    //% weight=80
    export function showKoreanText(hexCodes: string, x: number, y: number): void {
        ensureBuffer();
        let codes = hexCodes.split(" ");
        let curX = x;
        
        for (let code of codes) {
            if (code.length == 0) continue;
            let charCode = parseInt("0x" + code);
            
            if (charCode >= 0xAC00 && charCode <= 0xD7A3) {
                drawKorean(charCode, curX, y);
                curX += 16;
            } else if (charCode >= 0x20 && charCode <= 0x7F) {
                drawAscii(charCode, curX, y);
                curX += 8;
            }
            
            if (curX >= 128) break;
        }
    }

    //% blockId=oled_show_korean_text_sh1106
    //% block="OLED 1.3 한글출력 $hexCodes x: $x y: $y"
    //% hexCodes.defl="BC24 C591 AC31"
    //% x.min=0 x.max=127 x.defl=0
    //% y.min=0 y.max=6 y.defl=0
    //% group="OLED 1.3 SH1106"
    //% weight=80
    export function showKoreanTextSH1106(hexCodes: string, x: number, y: number): void {
        showKoreanText(hexCodes, x, y);
    }

    // ============================================================
    // 한글 조합 렌더링
    // ============================================================

    function drawKorean(charCode: number, x: number, y: number) {
        let code = charCode - 0xAC00;
        if (code < 0 || code > 11171) return;

        // 초성, 중성, 종성 분리
        let last = code % 28;              // 종성 0-27
        code = Math.idiv(code, 28);
        let first = Math.idiv(code, 21) + 1;  // 초성 1-19
        let mid = (code % 21) + 1;            // 중성 1-21

        // 벌수 계산
        let firstType = 0;
        let midType = 0;
        let lastType = 0;

        if (last == 0) {
            // 받침 없음
            firstType = cho1[mid];
            if (first == 1 || first == 24) midType = 0;
            else midType = 1;
        } else {
            // 받침 있음
            firstType = cho2[mid];
            if (first == 1 || first == 24) midType = 2;
            else midType = 3;
            lastType = jong[mid];
        }

        // 32바이트 버퍼 생성
        let buf: number[] = [];
        for (let i = 0; i < 32; i++) buf.push(0);

        // 초성 복사 (0~159)
        let pF = firstType * 20 + first;
        for (let i = 0; i < 32; i++) {
            buf[i] = K_FONT[pF * 32 + i];
        }

        // 중성 OR (160~247)
        pF = 160 + midType * 22 + mid;
        for (let i = 0; i < 32; i++) {
            buf[i] |= K_FONT[pF * 32 + i];
        }

        // 종성 OR (248~359)
        if (last > 0) {
            pF = 248 + lastType * 28 + last;
            for (let i = 0; i < 32; i++) {
                buf[i] |= K_FONT[pF * 32 + i];
            }
        }

        // 버퍼에 그리기
        let pageY = y;
        
        // 상단 8픽셀
        if (pageY < 8) {
            for (let col = 0; col < 16; col++) {
                if (x + col < 128) {
                    let bufIdx = 1 + (pageY * 128) + (x + col);
                    if (bufIdx < 1025) {
                        oled_buffer[bufIdx] |= buf[col];
                    }
                }
            }
        }
        
        // 하단 8픽셀
        pageY++;
        if (pageY < 8) {
            for (let col = 0; col < 16; col++) {
                if (x + col < 128) {
                    let bufIdx = 1 + (pageY * 128) + (x + col);
                    if (bufIdx < 1025) {
                        oled_buffer[bufIdx] |= buf[16 + col];
                    }
                }
            }
        }
    }

    function drawAscii(charCode: number, x: number, y: number) {
        if (charCode < 0 || charCode > 127) return;
        
        let idx = charCode * 16;
        let pageY = y;
        
        // 상단 8픽셀
        if (pageY < 8) {
            for (let col = 0; col < 8; col++) {
                if (x + col < 128 && idx + col < E_FONT.length) {
                    let bufIdx = 1 + (pageY * 128) + (x + col);
                    if (bufIdx < 1025) {
                        oled_buffer[bufIdx] |= E_FONT[idx + col];
                    }
                }
            }
        }
        
        // 하단 8픽셀
        pageY++;
        if (pageY < 8) {
            for (let col = 0; col < 8; col++) {
                if (x + col < 128 && idx + 8 + col < E_FONT.length) {
                    let bufIdx = 1 + (pageY * 128) + (x + col);
                    if (bufIdx < 1025) {
                        oled_buffer[bufIdx] |= E_FONT[idx + 8 + col];
                    }
                }
            }
        }
    }
}
